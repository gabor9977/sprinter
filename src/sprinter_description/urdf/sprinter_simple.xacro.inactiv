<?xml version="1.0"?>
<robot name="sprinter" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- ============ Leg macro (prefix/y_sign avoids earlier 'side' issues) ============ -->
  <xacro:macro name="leg"
               params="prefix y_sign pelvis_w hip_z thigh_L shank_L thigh_r shank_r">
    <xacro:property name="hip_y"  value="${y_sign * pelvis_w/2.0}"/>
    <xacro:property name="knee_z" value="${hip_z - thigh_L}"/>

    <!-- Thigh -->
    <link name="${prefix}_thigh">
      <visual>
        <origin xyz="0 ${hip_y} ${hip_z - thigh_L/2.0}" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sprinter_description/meshes/Oberschenkel.stl"/>
        </geometry>
        <material name="Blue"><color rgba="0.2 0.4 0.8 1"/></material>
      </visual>
      <collision>
        <origin xyz="0 ${hip_y} ${hip_z - thigh_L/2.0}" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sprinter_description/meshes/Oberschenkel.stl"/>
        </geometry>
      </collision>
      <!-- inertial optional for RViz, kept sane anyway -->
      <inertial>
        <origin xyz="0 ${hip_y} ${hip_z - thigh_L/2.0}" rpy="0 0 0"/>
        <mass value="7.5"/>
        <inertia ixx="0.12" ixy="0" ixz="0" iyy="0.12" iyz="0" izz="0.03"/>
      </inertial>
    </link>

    <!-- Hip (pitch around Y) -->
    <joint name="${prefix}_hip_joint" type="revolute">
      <parent link="base_link"/>
      <child  link="${prefix}_thigh"/>
      <origin xyz="0 ${hip_y} ${hip_z}" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit lower="-0.35" upper="2.10" velocity="10.0" effort="100.0"/>
    </joint>

    <!-- Shank -->
    <link name="${prefix}_shank">
      <visual>
        <origin xyz="0 ${hip_y} ${knee_z - shank_L/2.0}" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sprinter_description/meshes/Bein.stl"/>
        </geometry>
        <material name="Green"><color rgba="0.2 0.8 0.4 1"/></material>
      </visual>
      <collision>
        <origin xyz="0 ${hip_y} ${knee_z - shank_L/2.0}" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://sprinter_description/meshes/Bein.stl"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 ${hip_y} ${knee_z - shank_L/2.0}" rpy="0 0 0"/>
        <mass value="3.5"/>
        <inertia ixx="0.06" ixy="0" ixz="0" iyy="0.06" iyz="0" izz="0.02"/>
      </inertial>
    </link>

    <!-- Knee (pitch around Y) -->
    <joint name="${prefix}_knee_joint" type="revolute">
      <parent link="${prefix}_thigh"/>
      <child  link="${prefix}_shank"/>
      <origin xyz="0 ${hip_y} ${knee_z}" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit lower="0.0" upper="2.10" velocity="12.0" effort="80.0"/>
    </joint>
  </xacro:macro>

  <!-- ============ Global geometry params (meters) ============ -->
  <xacro:property name="pelvis_w" value="0.28"/>
  <xacro:property name="hip_z"    value="0.90"/>
  <xacro:property name="thigh_L"  value="0.40"/>
  <xacro:property name="shank_L"  value="0.40"/>
  <xacro:property name="thigh_r"  value="0.06"/>
  <xacro:property name="shank_r"  value="0.05"/>

  <!-- Pelvis (base) -->
  <link name="base_link">
    <visual>
      <origin xyz="0 0 ${hip_z}" rpy="0 0 0"/>
      <geometry><box size="${pelvis_w} 0.06 0.10"/></geometry>
      <material name="Grey"><color rgba="0.6 0.6 0.6 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 ${hip_z}" rpy="0 0 0"/>
      <geometry><box size="${pelvis_w} 0.06 0.10"/></geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 ${hip_z}" rpy="0 0 0"/>
      <mass value="10.0"/>
      <inertia ixx="0.20" ixy="0" ixz="0" iyy="0.20" iyz="0" izz="0.20"/>
    </inertial>
  </link>

  <!-- Two legs -->
  <xacro:leg prefix="left"  y_sign="1.0"
             pelvis_w="${pelvis_w}" hip_z="${hip_z}"
             thigh_L="${thigh_L}" shank_L="${shank_L}"
             thigh_r="${thigh_r}" shank_r="${shank_r}"/>

  <xacro:leg prefix="right" y_sign="-1.0"
             pelvis_w="${pelvis_w}" hip_z="${hip_z}"
             thigh_L="${thigh_L}" shank_L="${shank_L}"
             thigh_r="${thigh_r}" shank_r="${shank_r}"/>

</robot>
